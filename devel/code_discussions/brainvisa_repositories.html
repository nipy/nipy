<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Neuroimaging in Python &#8212; NIPY Documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/nipy.css?v=b92af819" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <script src="../../_static/documentation_options.js?v=0073ef5f"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Repository API" href="repository_api.html" />
    <link rel="prev" title="Repository design" href="repository_design.html" />
  <meta name="keywords" content="nipy, neuroimaging, python, neuroscience, time
				 series">

  </head><body>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
 <a href="../../index.html">
  <img src="../../_static/reggie2.png" alt="NIPY logo"  border="0" />
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="repository_api.html" title="Repository API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="repository_design.html" title="Repository design"
             accesskey="P">previous</a> |</li>
  <li><a href="../../index.html">NIPY home</a> |&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../../documentation.html" >NIPY documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >Developer Guide</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" accesskey="U">Code discussions</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Neuroimaging in Python</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="can-nipy-get-something-interesting-from-brainvisa-databases">
<span id="brainvisa-repositories"></span><h1>Can NIPY get something interesting from BrainVISA databases?<a class="headerlink" href="#can-nipy-get-something-interesting-from-brainvisa-databases" title="Link to this heading">¶</a></h1>
<p>I wrote this document to try to give more information to the NIPY
developers about the present and future of <a class="reference internal" href="../../glossary.html#term-BrainVisa"><span class="xref std std-term">BrainVISA</span></a> database
system. I hope it will serve the discussion opened by Jarrod Millman
about a possible collaboration between the two projects on this
topic. Unfortunately, I do not know other projects providing similar
features (such as BIRN) so I will only focus on BrainVISA.</p>
<p>Yann Cointepas</p>
<p>2006-11-21</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>In BrainVISA, all the database system is home made and written in
Python. This system is based on the file system and allows to do
requests for both reading and writing (get the name of non existing
files). We will change this in the future by defining an API (such the
one introduced below) and by using at least two implementations, one
relying on a relational database system and one compatible with the
actual database system. Having one single API will make it possible,
for instance, to work on huge databases located on servers and on
smaller databases located in a laptop directory (with some
synchronization features). This system will be independent from the
BrainVISA application, it could be packaged separately. Unfortunately,
we cannot say when this work will be done (our developments are slowed
because all our lab will move in a new institute in January
2007). Here is a summary describing actual BrainVISA database system
and some thoughts of what it may become.</p>
</section>
<section id="what-is-a-database-in-brainvisa-today">
<h2>What is a database in BrainVISA today?<a class="headerlink" href="#what-is-a-database-in-brainvisa-today" title="Link to this heading">¶</a></h2>
<p>A directory is a BrainVISA database if the structure of its
sub-directories and the file names in this directory respect a set of
rules. These rules make it possible to BrainVISA to scan the whole
directory contents and to identify without ambiguity the database
elements. These elements are composed of the following information:</p>
<ul class="simple">
<li><dl class="simple">
<dt><em>Data type:</em> identify the contents of a data (image, mesh,</dt><dd><p>functional image, anatomical RM, etc). The data types are organized
in hierarchy making it possible to decline a generic type in
several specialized types. For example, there is a 4D Image type
which is specialized in 3D Image. 3D Image is itself declined in
several types of which T1 MRI and Brain mask.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>File format:</em> Represent the format of files used to record a</dt><dd><p>data. BrainVISA is able to recognize several file formats (for
example DICOM, Analyze/SPM, GIS, etc). It is easy to add new data
formats and to provide converters to make it possible for existing
processes to use these new formats.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>Files:</em> contains the names of the files (and/or directories) used</dt><dd><p>to record the data.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>Attributes:</em> an attribute is an association between a name and a</dt><dd><p>value. A set of attributes is associated with each element of
BrainVISA database. This set represents all of the characteristics
of a data (as the image size, the name of the protocol
corresponding to the data or the acquisition
parameters). Attributes values are set by BrainVISA during
directory scanning (typically protocol, group, subject, etc.).</p>
</dd>
</dl>
</li>
</ul>
<p>It is possible to completely define the set of rules used to convert a
directory in a BrainVISA database. That allows the use of BrainVISA
without having to modify an existing file organization. However, the
writing of such a system of rules requires very good knowledge of
BrainVISA. This is why BrainVISA is provided with a default data
organization system that can be used easily.</p>
<p>A database can be used for deciding where to write data. The set of
rules is used to generate the appropriate file name according to the
data type, file format and attributes. This is a key feature that
greatly helps the users and allow automation.</p>
<p>It is not mandatory to use a database to process data with
BrainVISA. However, some important features are not available when you
are using data which are not in a database. For example, the BrainVISA
ability to construct a default output file name when an input data is
selected in a process relies on the database system. Moreover, some
processes use the database system to find data; for example, the brain
mask viewer tries to find the T1 MRI used to build the brain mask in
order to superimpose both images in an Anatomist window.</p>
</section>
<section id="a-few-thoughts-about-a-possible-api-for-repositories">
<h2>A few thoughts about a possible API for repositories<a class="headerlink" href="#a-few-thoughts-about-a-possible-api-for-repositories" title="Link to this heading">¶</a></h2>
<p>I think the most important point for data repositories is to define an
user API.  This API should be independent of data storage and of data
organization. Data organization is important because it is very
difficult to find a single organization that covers the needs of all
users in the long term. In this API, each data item should have an
unique identifier (let’s call it an URL). The rest of the API could be
divided in two parts:</p>
<ol class="arabic simple">
<li><p>An indexation system managing data organization. It defines
properties attached to data items (for instance, “group” or
“subject” can be seen as properties of an FMRI image) as well as
possible user requests on the data. This indexation API could have
several implementations (relational database, BIRN, BrainVISA,
etc.).</p></li>
<li><p>A data storage system managing the link between the URL of a data
item and its representation on a local file system. This system
should take into account various file formats and various file
storage systems (e.g. on a local file system, on a distant ftp
site, as bytes blocks in a relational database).</p></li>
</ol>
<p>This separation between indexation and storage is important for the
design of databases, it makes it possible, for instance, to use
distant or local data storage, or to define several indexations
(i.e. several data organizations) for the same data. However
indexation and data storage are not always independent. For example,
they are independent if we use a relational database for indexation
and URLs for storage, but they are not if file or directory names give
indexation information (like in BrainVISA databases described
above). At the user level, things can be simpler because the
separation can be hidden in one object: the repository. A repository
is composed of one indexation system and one data storage system and
manage all the links between them. The user can send requests to the
repository and receive a set of data items. Each data item contains
indexation information (via the indexation system) and gives access to
the data (via the storage system). Here is a sample of
what-user-code-could-be to illustrate what I have in mind followed by
a few comments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Get an access to one repository
repository = openRepository( repositoryURL )
# Create a request for selection of all the FMRI in the repository
request = ‘SELECT * FROM FMRI’
# Iterate on data items in the repository
for item in repository.select( request ):
  print item.url
  # Item is a directory-like structure for properties access
  for property in item:
    print property, ‘=’, item[ property ]
  # Retrieve the file(s) (and directorie(s) if any) from the data storage system
  # and convert it to NIFTI format (if necessary).
  files = item.getLocalFiles( format=’NIFTI’ )
  niftiFileName = files[ 0 ]
  # Read the image and do something with it
  ...
</pre></div>
</div>
<ol class="arabic simple">
<li><p>I do not yet have a good idea of how to represent requests. Here, I
chose to use SQL since it is simple to understand.</p></li>
<li><p>This code does not make any assumption on the properties that are
associated to an FMRI image.</p></li>
<li><p>The method getLocalFiles can do nothing more than return a file
name if the data item correspond to a local file in NIFTI
format. But the same code can be used to access a DICOM image
located in a distant ftp server. In this case, getLocalFiles will
manage the transfer of the DICOM file, then the conversion to the
required NIFTI format and return name of temporary file(s).</p></li>
<li><p>getLocalFiles cannot always return just one file name because on
the long term, there will be many data types (FMRI, diffusion MRI,
EEG, MEG, etc.)  that are going to be stored in the
repositories. These different data will use various file
formats. Some of these formats can use a combination of files and
directories (for instance, CTF MEG raw data are stored in a
directory (<code class="docutils literal notranslate"><span class="pre">*.ds</span></code>), the structural sulci format of BrainVISA is
composed of a file(<code class="docutils literal notranslate"><span class="pre">*.arg</span></code>) and a directory (<code class="docutils literal notranslate"><span class="pre">*.data</span></code>), NIFTI images
can be in one or two files, etc. ).</p></li>
<li><p>The same kind of API can be used for writing data items in a
repository. One could build a data item, adds properties and files
and call something like repository.update( item ).</p></li>
</ol>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">


<h4> Site Navigation </h4>
  <ul>
    <li><a href="../../documentation.html">Documentation</a></li>
    <li><a href="../index.html">Development</a></li>
  </ul>

<h4> NIPY Community </h4>
  <ul class="simple">
    <li><a class="reference external"
	href="http://nipy.org/">Community Home</a></li>
    <li><a class="reference external"
	href="http://nipy.org/project-directory">NIPY Projects</a></li>
    <li><a class="reference external"
	href="https://mail.python.org/mailman/listinfo/neuroimaging">Mailing List</a></li>
    <li><a class="reference external"
	href="license.html">License</a></li>
  </ul>

<h4> Github repo </h4>
  <ul class="simple">
    <li><a class="reference external"
	href="http://github.com/nipy/nipy/">Nipy Github</a></li>
  </ul>

  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Can NIPY get something interesting from BrainVISA databases?</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#what-is-a-database-in-brainvisa-today">What is a database in BrainVISA today?</a></li>
<li><a class="reference internal" href="#a-few-thoughts-about-a-possible-api-for-repositories">A few thoughts about a possible API for repositories</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="repository_design.html"
                          title="previous chapter">Repository design</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="repository_api.html"
                          title="next chapter">Repository API</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/devel/code_discussions/brainvisa_repositories.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="repository_api.html" title="Repository API"
             >next</a> |</li>
        <li class="right" >
          <a href="repository_design.html" title="Repository design"
             >previous</a> |</li>
  <li><a href="../../index.html">NIPY home</a> |&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../../documentation.html" >NIPY documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >Developer Guide</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" >Code discussions</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Neuroimaging in Python</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2005-2023, Neuroimaging in Python team.
      Last updated on Feb 20, 2024.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>